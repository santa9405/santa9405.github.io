---
title: "WebServer"
excerpt: "WebServer Project - 게시판 상세 조회, 검색"
search: true
categories: 
  - Academy
tags: 
  - Servlet
  - Java
  - HTML
  - CSS
  - JSP
toc: true
---
## 기능 화면
- 게시판 상세 조회, 검색<br>
![녹화_2021_01_06_22_30_18_513](https://user-images.githubusercontent.com/72387870/103773711-d24fc580-506e-11eb-928b-0efc17f209c9.gif)<br><br>

## 실습

### com.kh.wsp/board/controller

- BoardController.java

```java
package com.kh.wsp.board.controller;

import java.io.IOException;
import java.util.List;

import javax.servlet.RequestDispatcher;
import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import com.kh.wsp.board.model.service.BoardService;
import com.kh.wsp.board.model.vo.Board;
import com.kh.wsp.board.model.vo.PageInfo;

@WebServlet("/board/*")
public class BoardControlloer extends HttpServlet {
	private static final long serialVersionUID = 1L;

	protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		
		String uri = request.getRequestURI();          // /wsp/board/list.do 요청이 들어오는 주소
		String contextPath = request.getContextPath(); // /wsp 프로젝트 주소
		String command = uri.substring( (contextPath + "/board").length() ); // /wsp/board를 잘라낸 주소 == /list.do
		
		//System.out.println(command);
		
		String path = null;
		RequestDispatcher view = null;
		
		String swalIcon = null;
		String swalTitle = null;
		String swalText = null;
		
		String errorMsg = null;
		
		try {
			BoardService service = new BoardService();
			
			// 현재 페이지를 얻어옴
			String cp = request.getParameter("cp");
			
			// 게시글 목록 조회 Controller------------------------------------
			if(command.equals("/list.do")) {
				errorMsg = "게시판 목록 조회 과정에서 오류 발생";
				
				// 1. 페이징 처리를 위한 값 계산 Service 호출
				PageInfo pInfo = service.getPageInfo(cp);
				//System.out.println(pInfo);
				
				// 2. 게시글 목록 조회 비즈니스 로직 수행
				List<Board> bList = service.selectBoardList(pInfo);
				// pInfo에 있는 currentPage, limit를 사용해야지만
				// 현재 페이지에 맞는 게시글 목록만 조회할 수 있음.
				
//				for(Board b : bList) {
//					System.out.println(b);
//				}
				
				path = "/WEB-INF/views/board/boardList.jsp";
				
				request.setAttribute("bList", bList);
				request.setAttribute("pInfo", pInfo);
				
				view = request.getRequestDispatcher(path);
				view.forward(request, response);
			}

			// 게시글 상세 조회 Controller-------------------------------------------------
			else if(command.equals("/view.do")) {
				errorMsg = "게시글 상세 조회 과정에서 오류 발생";
				int boardNo = Integer.parseInt(request.getParameter("no"));
				
				// 상세조회 비즈니스 로직 수행 후 결과 반환 받기
				Board board = service.selectBoard(boardNo);
				
				if(board != null) { // 상세 조회 성공
					
					path = "/WEB-INF/views/board/boardView.jsp";
					request.setAttribute("board", board);
					view = request.getRequestDispatcher(path);
					view.forward(request, response);
					
				}else { // 상세 조회 실패
					
					request.getSession().setAttribute("swalIcon", "error");
					request.getSession().setAttribute("swalTitle", "게시글 상세 조회 실패");
					response.sendRedirect("list.do?cp=1");
				}
			}
			
			// 게시글 작성 화면 전환 Controller----------------------------------------------
			else if(command.equals("/insertForm.do")) {
				
				path = "/WEB-INF/views/board/boardInsert.jsp";
				view = request.getRequestDispatcher(path);
				view.forward(request, response);
			}
			
		}catch(Exception e) {
			e.printStackTrace();
			path = "/WEB-INF/views/common/errorPage.jsp";
			request.setAttribute("errorMsg", errorMsg);
			view = request.getRequestDispatcher(path);
			view.forward(request, response);
		}
	}

	protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		doGet(request, response);
	}
}
```
<br><br>

### com.kh.wsp/board/service

- BoardService.java

```java
package com.kh.wsp.board.model.service;

import static com.kh.wsp.common.JDBCTemplate.*;

import java.sql.Connection;
import java.util.List;

import com.kh.wsp.board.model.dao.BoardDAO;
import com.kh.wsp.board.model.vo.Board;
import com.kh.wsp.board.model.vo.PageInfo;

public class BoardService {
	
	private BoardDAO dao = new BoardDAO();

	/** 페이징 처리를 위한 값 계산 Service
	 * @param cp
	 * @return pInfo
	 * @throws Exception
	 */
	public PageInfo getPageInfo(String cp) throws Exception {
		Connection conn = getConnection();
		
		// cp가 null일 경우
		int currentPage = cp == null ? 1 : Integer.parseInt(cp);
		
		// DB에서 전체 게시글 수를 조회하여 반환 받기
		int listCount = dao.getListCount(conn);
		
		close(conn);
		
		// 얻어온 현재 페이지와, DB에서 조회한 전체 게시글 수를 이용하여
		// PageInfo 객체를 생성함
		return new PageInfo(currentPage, listCount);
	}

	/** 게시글 목록 조회 Service
	 * @param pInfo
	 * @return bList
	 * @throws Exception
	 */
	public List<Board> selectBoardList(PageInfo pInfo) throws Exception {
		Connection conn = getConnection();
		
		List<Board> bList = dao.selectBoardList(conn, pInfo);
		
		close(conn);
		
		return bList;
	}

	/** 게시글 상세 조회 Service
	 * @param boardNo
	 * @return board
	 * @throws Exception
	 */
	public Board selectBoard(int boardNo) throws Exception {
		Connection conn = getConnection();
		Board board = dao.selectBoard(conn, boardNo);
		
		if(board != null) { // DB에서 조회 성공 시
			
			// 조회수 증가
			int result = dao.increaseReadCount(conn, boardNo);
			
			if(result > 0) {
				commit(conn);
				
				// 반환되는 Board 데이터에는 조회수가 증가되어 있지 않기 때문에
				// 조회수를 1 증가 시켜줌
				board.setReadCount( board.getReadCount() + 1 );
				
			}else {
				rollback(conn);
			}
			
		}
		close(conn);
		return board;
	}
}
```
<br><br>

### com.kh.wsp/board/vo

- Board.java

```java
package com.kh.wsp.board.model.vo;

import java.sql.Timestamp;

public class Board {
	// V_BOARD의 모양
	private int boardNo;
	private String boardTitle;
	private String boardContent;
	private String memberId;
	private int readCount;
	private String categoryName;
	private Timestamp boardCreateDate;
	private Timestamp boardModifyDate;
	private String boardStatus;
	
	public Board() { }

	public Board(int boardNo, String boardTitle, String boardContent, String memberId, int readCount,
			String categoryName, Timestamp boardCreateDate, Timestamp boardModifyDate, String boardStatus) {
		super();
		this.boardNo = boardNo;
		this.boardTitle = boardTitle;
		this.boardContent = boardContent;
		this.memberId = memberId;
		this.readCount = readCount;
		this.categoryName = categoryName;
		this.boardCreateDate = boardCreateDate;
		this.boardModifyDate = boardModifyDate;
		this.boardStatus = boardStatus;
	}
	
	// 게시글 목록 조회
	public Board(int boardNo, String boardTitle, String memberId, int readCount, String categoryName,
			Timestamp boardCreateDate) {
		super();
		this.boardNo = boardNo;
		this.boardTitle = boardTitle;
		this.memberId = memberId;
		this.readCount = readCount;
		this.categoryName = categoryName;
		this.boardCreateDate = boardCreateDate;
	}

	public int getBoardNo() {
		return boardNo;
	}

	public void setBoardNo(int boardNo) {
		this.boardNo = boardNo;
	}

	public String getBoardTitle() {
		return boardTitle;
	}

	public void setBoardTitle(String boardTitle) {
		this.boardTitle = boardTitle;
	}

	public String getBoardContent() {
		return boardContent;
	}

	public void setBoardContent(String boardContent) {
		this.boardContent = boardContent;
	}

	public String getMemberId() {
		return memberId;
	}

	public void setMemberId(String memberId) {
		this.memberId = memberId;
	}

	public int getReadCount() {
		return readCount;
	}

	public void setReadCount(int readCount) {
		this.readCount = readCount;
	}

	public String getCategoryName() {
		return categoryName;
	}

	public void setCategoryName(String categoryName) {
		this.categoryName = categoryName;
	}

	public Timestamp getBoardCreateDate() {
		return boardCreateDate;
	}

	public void setBoardCreateDate(Timestamp boardCreateDate) {
		this.boardCreateDate = boardCreateDate;
	}

	public Timestamp getBoardModifyDate() {
		return boardModifyDate;
	}

	public void setBoardModifyDate(Timestamp boardModifyDate) {
		this.boardModifyDate = boardModifyDate;
	}

	public String getBoardStatus() {
		return boardStatus;
	}

	public void setBoardStatus(String boardStatus) {
		this.boardStatus = boardStatus;
	}

	@Override
	public String toString() {
		return "Board [boardNo=" + boardNo + ", boardTitle=" + boardTitle + ", boardContent=" + boardContent
				+ ", memberId=" + memberId + ", readCount=" + readCount + ", categoryName=" + categoryName
				+ ", boardCreateDate=" + boardCreateDate + ", boardModifyDate=" + boardModifyDate + ", boardStatus="
				+ boardStatus + "]";
	}
}
```
<br><br>

- PageInfo.java

```java
package com.kh.wsp.board.model.vo;

public class PageInfo { // 페이징 처리를 위한 값을 저장할 객체
	
	// 얻어올 값
	private int currentPage;   // 현재 페이지 번호를 저장할 변수
	private int listCount;	   // 전체 게시글 수를 저장할 변수
	
	// 설정할 값
	private int limit = 10;    // 한 페이지에 보여질 게시글 목록 수
	private int pageSize = 10; // 하단의 페이징바에 표시될 페이지 수
	
	// 계산할 값
	private int maxPage;       // 페이징바 전체 페이지의 수 == 마지막 페이지
    private int startPage;     // 페이징바 시작 페이지 번호
    private int endPage;       // 페이징바 끝 페이지 번호
    
    // 기본 생성자 사용X
    
	public PageInfo(int currentPage, int listCount) {
		super();
		this.currentPage = currentPage;
		this.listCount = listCount;
		
		// vo가 생성 되자마자
		// 전달받은 값과 명시적으로 선언된 값을 이용하여
		// makePageInfo() 수행
		makePageInfo();
	}

	public PageInfo(int currentPage, int listCount, int limit, int pageSize) {
		super();
		this.currentPage = currentPage;
		this.listCount = listCount;
		this.limit = limit;
		this.pageSize = pageSize;
		
		makePageInfo();
	}

	public int getCurrentPage() {
		return currentPage;
	}

	public void setCurrentPage(int currentPage) {
		this.currentPage = currentPage;
	}

	public int getListCount() {
		return listCount;
	}

	public void setListCount(int listCount) {
		this.listCount = listCount;
		makePageInfo();
	}

	public int getLimit() {
		return limit;
	}

	public void setLimit(int limit) {
		this.limit = limit;
		makePageInfo();
	}

	public int getPageSize() {
		return pageSize;
	}

	public void setPageSize(int pageSize) {
		this.pageSize = pageSize;
		makePageInfo();
	}

	public int getMaxPage() {
		return maxPage;
	}

	public void setMaxPage(int maxPage) {
		this.maxPage = maxPage;
	}

	public int getStartPage() {
		return startPage;
	}

	public void setStartPage(int startPage) {
		this.startPage = startPage;
	}

	public int getEndPage() {
		return endPage;
	}

	public void setEndPage(int endPage) {
		this.endPage = endPage;
	}

	@Override
	public String toString() {
		return "PageInfo [currentPage=" + currentPage + ", listCount=" + listCount + ", limit=" + limit + ", pageSize="
				+ pageSize + ", maxPage=" + maxPage + ", startPage=" + startPage + ", endPage=" + endPage + "]";
	}
	
	// 페이징 처리에 필요한 값을 계산하는 메소드
	private void makePageInfo() {
		
		// maxPage : 페이징바 전체 페이지의 수 == 마지막 페이지
		// 총 게시글 수 100개, 한 페이지에 보여지는 게시글 수 10개
		// -> 총 페이지 수는? 100 / 10 = 10page
		
		// 총 게시글 수 100개, 한 페이지에 보여지는 게시글 수 10개
		// -> 총 페이지 수는? 101 / 10 = 10.1(올림 처리) -> 11page
		maxPage = (int)Math.ceil( (double)listCount / limit );
		
		// startPage : 페이징바 시작 번호
		// 페이징바에 페이지를 10개씩 보여줄 경우
		// 1, 11, 21, 31, ...
		// 현재 페이지 11 -> 시작 페이지 11
		// 현재 페이지 15 -> 시작 페이지 11
		// 현재 페이지 20 -> 시작 페이지 11
		startPage = (currentPage -1) / pageSize * pageSize + 1;
					//        (11-1) /  10 * 10 + 1 == 11
					//        (15-1) /  10 * 10 + 1 == 11
					//        (20-1) /  10 * 10 + 1 == 11
		
		// endPage : 페이징바 끝 번호
		// 페이징바에 페이지를 10개씩 보여줄 경우
		// 10, 20, 30, 40, ...
		// 현재 페이지 11 -> 시작 페이지 20
		// 현재 페이지 15 -> 시작 페이지 20
		// 현재 페이지 20 -> 시작 페이지 20
		endPage = startPage + pageSize - 1;
		
		// 총 페이지의 수가 endPage 보다 작을 경우
		if(maxPage <= endPage) {
			endPage = maxPage;
		}
	}
}
```
<br><br>

### com.kh.wsp/board/dao

- BoardDAO.java

```java
package com.kh.wsp.board.model.dao;

import static com.kh.wsp.common.JDBCTemplate.*;

import java.io.FileInputStream;
import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.Statement;
import java.util.ArrayList;
import java.util.List;
import java.util.Properties;

import com.kh.wsp.board.model.vo.Board;
import com.kh.wsp.board.model.vo.PageInfo;

public class BoardDAO {
	private Statement stmt = null;
	private PreparedStatement pstmt = null;
	private ResultSet rset = null;
	
	private Properties prop = null;
	
	public BoardDAO(){
		String fileName = BoardDAO.class.getResource("/com/kh/wsp/sql/board/board-query.xml").getPath();
		try {
			prop = new Properties();
			prop.loadFromXML(new FileInputStream(fileName)); 
		} catch (Exception e) {
			e.printStackTrace();
		}
	}

	/** 전체 게시글 수 반환 DAO
	 * @param conn
	 * @return listCount
	 * @throws Exception
	 */
	public int getListCount(Connection conn) throws Exception {
		int listCount = 0;
		
		String query = prop.getProperty("getListCount");
		
		try {
			stmt = conn.createStatement();
			
			rset = stmt.executeQuery(query);
			
			if(rset.next()) {
				listCount = rset.getInt(1);
			}
			
		}finally {
			close(stmt);
			close(rset);
		}
		return listCount;
	}

	/** 게시글 목록 조회 DAO
	 * @param conn
	 * @param pInfo
	 * @return bList
	 * @throws Exception
	 */
	public List<Board> selectBoardList(Connection conn, PageInfo pInfo) throws Exception {
		List<Board> bList = null;
		
		String query = prop.getProperty("selectBoardList");
		
		try {
			// SQL 구문 조건절에 대입할 변수 생성
			int startRow = (pInfo.getCurrentPage() -1) * pInfo.getLimit() + 1;
			int endRow = startRow + pInfo.getLimit() -1;
			
			pstmt = conn.prepareStatement(query);
			
			pstmt.setInt(1, startRow);
			pstmt.setInt(2, endRow);
			
			rset = pstmt.executeQuery();
			
			bList = new ArrayList<Board>();
			
			while(rset.next()) {
				Board board = new Board(
						rset.getInt("BOARD_NO"), 
						rset.getNString("BOARD_TITLE"), 
						rset.getNString("MEMBER_ID"), 
						rset.getInt("READ_COUNT"), 
						rset.getNString("CATEGORY_NM"), 
						rset.getTimestamp("BOARD_CREATE_DT"));
				bList.add(board);
			}
			
		}finally {
			close(rset);
			close(pstmt);
		}
		return bList;
	}

	/** 게시글 상세 조회 DAO
	 * @param conn
	 * @param boardNo
	 * @return board
	 * @throws Exception
	 */
	public Board selectBoard(Connection conn, int boardNo) throws Exception {
		Board board = null;
		
		String query = prop.getProperty("selectBoard");
		
		try {
			pstmt = conn.prepareStatement(query);
			pstmt.setInt(1, boardNo);
			rset = pstmt.executeQuery();
			
			if(rset.next()) {
				board = new Board();
				
				board.setBoardNo( rset.getInt("BOARD_NO") );
				board.setBoardTitle( rset.getString("BOARD_TITLE") );
				board.setBoardContent( rset.getString("BOARD_CONTENT") );
				board.setMemberId( rset.getString("MEMBER_ID") );
				board.setReadCount( rset.getInt("READ_COUNT") );
				board.setBoardCreateDate( rset.getTimestamp("BOARD_CREATE_DT") );
				board.setBoardModifyDate( rset.getTimestamp("BOARD_MODIFY_DT") );
				board.setCategoryName( rset.getString("CATEGORY_NM") );
			}
			
		}finally {
			close(rset);
			close(pstmt);
		}
		return board;
	}

	/** 조회수 증가 DAO
	 * @param conn
	 * @param boardNo
	 * @return result
	 * @throws Exception
	 */
	public int increaseReadCount(Connection conn, int boardNo) throws Exception {
		int result = 0;
		
		String query = prop.getProperty("increaseReadCount");
		
		try {
			pstmt = conn.prepareStatement(query);
			pstmt.setInt(1, boardNo);
			
			result = pstmt.executeUpdate();
			
		}finally {
			close(pstmt);
		}
		
		return result;
	}
}
```
<br><br>

### com.kh.wsp/search/controller

- SearchController.java

```java
package com.kh.wsp.search.controller;

import java.io.IOException;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

import javax.servlet.RequestDispatcher;
import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import com.kh.wsp.board.model.vo.Board;
import com.kh.wsp.board.model.vo.PageInfo;
import com.kh.wsp.search.model.service.SearchService;

@WebServlet("/search.do")
public class SearchController extends HttpServlet {
   private static final long serialVersionUID = 1L;
   
   
   
   protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
      String searchKey = request.getParameter("sk");
      String searchValue = request.getParameter("sv");
      String cp = request.getParameter("cp");
      
      try {
         SearchService service = new SearchService();
         
         Map<String, Object> map = new HashMap<String, Object>();
         map.put("searchKey", searchKey);
         map.put("searchValue", searchValue);
         map.put("currentPage", cp);
         
         // 페이징 처리를 위한 데이터를 계산하고 저장하는 객체 PageInfo 얻어오기
         PageInfo pInfo = service.getPageInfo(map);
         
         // 검색 게시글 목록 조회
         List<Board> bList = service.searchBoardList(map, pInfo);
         
         
         // 결과 확인
         System.out.println(pInfo);
         for(Board b : bList) {
            System.out.println(b);
         } 
         
         // 조회된 내용과 PageInfo 객체를 request객체에 담아서 요청 위임
         String path = "/WEB-INF/views/board/boardList.jsp";
         
         request.setAttribute("bList", bList);
         request.setAttribute("pInfo", pInfo);
         
         RequestDispatcher view = request.getRequestDispatcher(path);
         view.forward(request, response);
         
         
      }catch (Exception e) {
         e.printStackTrace();
         String path = "/WEB-INF/views/common/errorPage.jsp";
         request.setAttribute("errorMsg", "검색 과정에서 오류 발생");
         RequestDispatcher view = request.getRequestDispatcher(path);
         view.forward(request, response);
      }
      
   
   }

   protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
      doGet(request, response);
   }
}
```

<br><br>

### com.kh.wsp/search/service

- SearchService.java

```java
package com.kh.wsp.search.model.service;

import static com.kh.wsp.common.JDBCTemplate.*;

import java.sql.Connection;
import java.util.List;
import java.util.Map;

import com.kh.wsp.board.model.vo.Board;
import com.kh.wsp.board.model.vo.PageInfo;
import com.kh.wsp.search.model.dao.SearchDAO;

public class SearchService {
	private SearchDAO dao = new SearchDAO();

	/** 검색 내용이 포함된 페이징 처리 정보 생성 Service
	 * @param map
	 * @return map
	 * @throws Exception
	 */
	public PageInfo getPageInfo(Map<String, Object> map) throws Exception {
		Connection conn = getConnection();
		
		// 얻어온 파라미터 cp가 null이면 1, 아니면 int 형으로 파싱
		map.put("currentPage",  
				(map.get("currentPage") == null) ? 1 
							: Integer.parseInt((String)map.get("currentPage")));
		
		// 검색 조건에 따른 SQL 조건문을 조합하는 메소드 호출
		String condition = createCondition(map);
		
		// DB에서 조건을 만족하는 게시글의 수를 조회하기
		int listCount = dao.getListCount(conn, condition);
		
		// 커넥션 반환
		close(conn);
		
		// PageInfo 객체를 생성하여 반환
		return new PageInfo((int)map.get("currentPage"), listCount);
	}

	/** 검색 조건에 따라 SQL에 사용될 조건문을 조합하는 메소드
	 * @param map
	 * @return 
	 */
	private String createCondition(Map<String, Object> map) {
		
		String condition = null;
		
		String searchKey = (String)map.get("searchKey");
		String searchValue = (String)map.get("searchValue");
		
		// 검색 조건(searchKey)에 따라 SQL 조합
		switch(searchKey) {
		case "title" :
								// " BOARD_TITLE LIKE '%' || '49' || '%' "
			condition = " BOARD_TITLE LIKE '%' || '" + searchValue + "' || '%' ";
			break;
			
		case "content" :
			condition = " BOARD_CONTENT LIKE '%' || '" + searchValue + "' || '%' ";
			break;
			
		case "titcont" :
			condition = " (BOARD_TITLE LIKE '%' || '" + searchValue + "' || '%' "
						+ "OR BOARD_CONTENT LIKE '%' || '" + searchValue + "' || '%') ";
			break;
			
		case "writer" :
			condition = " MEMBER_ID LIKE '%' || '" + searchValue + "' || '%' ";
			break;
		}
		
		
		return condition;
	}

	/** 검색 게시글 목록 리스트 조회 Service
	 * @param map
	 * @param pInfo 
	 * @return bList
	 * @throws Exception
	 */
	public List<Board> searchBoardList(Map<String, Object> map, PageInfo pInfo) throws Exception {
		Connection conn = getConnection();
		
		String condition = createCondition(map);

		List<Board> bList = dao.searchBoardList(conn, pInfo, condition);
		
		close(conn);
		
		return bList;
	}
}
```

<br><br>

### com.kh.wsp/search/dao

- SearchDAO.java

```java
package com.kh.wsp.search.model.dao;

import static com.kh.wsp.common.JDBCTemplate.*;

import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.Statement;
import java.util.ArrayList;
import java.util.List;
import java.util.Map;

import com.kh.wsp.board.model.vo.Board;
import com.kh.wsp.board.model.vo.PageInfo;

public class SearchDAO {
	
	private Statement stmt = null;
	private PreparedStatement pstmt = null;
	private ResultSet rset = null;
	
	
	/** 조건을 만족하는 게시글 수 조회 DAO
	 * @param conn
	 * @param condition
	 * @return listCount
	 * @throws Exception
	 */
	public int getListCount(Connection conn, String condition) throws Exception {
		int listCount = 0;
		
		String query = "SELECT COUNT(*) FROM V_BOARD WHERE BOARD_STATUS = 'Y' AND " + condition;
		
		try {
			stmt = conn.createStatement();
			
			rset = stmt.executeQuery(query);
			if(rset.next()) {
				listCount = rset.getInt(1);
			}
		}finally {
			close(rset);
			close(stmt);
		}
		
		return listCount;
	}


	/** 검색 게시글 목록 조회 DAO
	 * @param conn
	 * @param pInfo
	 * @param condition
	 * @return bList
	 * @throws Exception
	 */
	public List<Board> searchBoardList(Connection conn, PageInfo pInfo, String condition) throws Exception {
		List<Board> bList = null;
		
		String query = 
				"SELECT * FROM" + 
				"    (SELECT ROWNUM RNUM , V.*" + 
				"    FROM" + 
				"        (SELECT * FROM V_BOARD " + 
				"        WHERE " + condition +
				"        AND BOARD_STATUS = 'Y' ORDER BY BOARD_NO DESC) V )" + 
				"WHERE RNUM BETWEEN ? AND ?";

		try {
			// SQL 구문 조건절에 대입할 변수 생성
			int startRow = (pInfo.getCurrentPage() -1) * pInfo.getLimit() + 1;
			int endRow = startRow + pInfo.getLimit() -1;
			
			pstmt = conn.prepareStatement(query);
			
			pstmt.setInt(1, startRow);
			pstmt.setInt(2, endRow);
			
			rset = pstmt.executeQuery();
			
			bList = new ArrayList<Board>();
			
			while(rset.next()) {
				Board board = new Board(
						rset.getInt("BOARD_NO"), 
						rset.getNString("BOARD_TITLE"), 
						rset.getNString("MEMBER_ID"), 
						rset.getInt("READ_COUNT"), 
						rset.getNString("CATEGORY_NM"), 
						rset.getTimestamp("BOARD_CREATE_DT"));
				bList.add(board);
			}
			
		}finally {
			close(rset);
			close(pstmt);
		}
		return bList;
	}
}
```

<br><br>

### com.kh.wsp/sql/board

- board-query.xml

```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE properties SYSTEM "http://java.sun.com/dtd/properties.dtd">
<properties>

<!-- 전체 게시글 수 조회 -->
<entry key="getListCount">
SELECT COUNT(*) FROM V_BOARD
WHERE BOARD_STATUS = 'Y'
</entry>

<!-- 지정된 페이지 게시글 목록 조회 -->
<entry key="selectBoardList">
SELECT * FROM
(SELECT ROWNUM RNUM, V.*
 FROM
    (SELECT * FROM V_BOARD WHERE BOARD_STATUS = 'Y' ORDER BY BOARD_NO DESC) V)
WHERE RNUM BETWEEN ? AND ?
</entry>

<!-- 게시글 상세 조회 -->
<entry key="selectBoard">
SELECT * FROM V_BOARD
WHERE BOARD_NO = ?
AND BOARD_STATUS = 'Y'
</entry>

<entry key="increaseReadCount">
UPDATE BOARD SET
READ_COUNT = READ_COUNT + 1
WHERE BOARD_NO = ?
</entry>

</properties>
```
<br><br>

### WebContent/WEB-INF/views/board

- BoardList.jsp

```jsp
<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt" %>


<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>게시판</title>
<style>
.pagination {
   justify-content: center;
}

#searchForm {
   position: relative;
}

#searchForm>* {
   top: 0;
}

.boardTitle>img {
   width: 50px;
   height: 50px;
}

#list-table th {
   text-align: center;
}

#list-table td:not(:nth-of-type(3)) {
   text-align: center;
}

.list-wrapper{
   height: 540px;
}

#list-table td:hover{
   cursor : pointer;
}


</style>

</head>
<body>
   <jsp:include page="../common/header.jsp"></jsp:include>
   <div class="container my-5">
      
      <h1>게시판</h1>
      
         <div class="list-wrapper">
            <table class="table table-hover table-striped my-5" id="list-table">
               <thead>
                  <tr>
                     <th>글번호</th>
                     <th>카테고리</th>
                     <th>제목</th>
                     <th>작성자</th>
                     <th>조회수</th>
                     <th>작성일</th>
                  </tr>
               </thead>
               
               <%-- 게시글 목록 출력 --%>
               <tbody>
                  <c:choose>
                     <c:when test="${empty bList}">
                        <tr>
                           <td colspan="6">존재하는 게시글이 없습니다.</td>
                        </tr>
                     </c:when>
                     
                     <c:otherwise> <%-- 조회된 게시글 목록이 있을 때 --%>
                        <c:forEach var="board" items="${bList}">
                           <tr>
                              <td>${board.boardNo}</td>
                              <td>${board.categoryName}</td>
                              <td class="boardTitle">
                              ${board.boardTitle}
                              </td>
                              <td>${board.memberId}</td>
                              <td>${board.readCount}</td>
                              <td>
                                 <%-- 날짜 출력 모양 지정 --%>
                                 <fmt:formatDate var="createDate"
                                     value="${board.boardCreateDate}"
                                      pattern="yyyy-MM-dd"/>  
                                      
                                                                            
                                 <fmt:formatDate var="today"
                                     value="<%= new java.util.Date() %>"
                                      pattern="yyyy-MM-dd"/> 
                                         
                                 
                                      
                                 <c:choose>
                                    <%-- 글 작성일이 오늘이 아닐 경우 --%>
                                    <c:when test="${createDate != today }">
                                       ${createDate}
                                    </c:when>
                                    
                                    <%-- 글 작성일이 오늘일 경우 --%>
                                    <c:otherwise>
                                       <fmt:formatDate value="${board.boardCreateDate}"
                                      pattern="HH:mm"/>    
                                    </c:otherwise>
                                 
                                 </c:choose>                                    
                              </td>
                           </tr>
                        </c:forEach>
                     </c:otherwise>
                  </c:choose>
               </tbody>
            </table>
         </div>


         <%-- 로그인이 되어있는 경우 --%>
         <c:if test="${!empty loginMember}">
         	<button type="button" class="btn btn-primary float-right" id="insertBtn" 
         	 onclick="location.href = '${contextPath}/board/insertForm.do'">글쓰기</button>
         </c:if>
         
         <%---------------------- Pagination ----------------------%>
         <%-- 페이징 처리 주소를 쉽게 사용할 수 있도록 미리 변수에 저장 --%>
         <c:choose>
            <%-- 검색 내용이 파라미터에 존재할 때 == 검색을 통해 만들어진 페이지인가? --%>
            <c:when test="${!empty param.sk && !empty param.sv}">
               <c:url var="pageUrl" value="/search.do"/>
               
               <!-- 쿼리스트링으로 사용할 내용을 변수에 저장 -->
               <c:set var="searchStr" value="&sk=${param.sk}&sv=${param.sv}"/>
            </c:when>
            
            <c:otherwise>
              <c:url var="pageUrl" value="/board/list.do"/>
            </c:otherwise>
            
         </c:choose>
         
         
         
         
         
         <!-- 화살표에 들어갈 주소를 변수로 생성 -->
         <%-- 
            검색을 안했을 때 : /board/list.do?cp=1
            검색을 했을 때 :  /search.do?cp=1&sk=title&sv=49
          --%>
         
         <c:set var="firstPage" value="${pageUrl}?cp=1${searchStr}"/>
         <c:set var="lastPage" value="${pageUrl}?cp=${pInfo.maxPage}${searchStr}"/>
         
         <%-- EL을 이용한 숫자 연산의 단점 : 연산이 자료형에 영향을 받지 않는다. --%>
         <%--
          <fmt : parseNumber> : 숫자 형태를 지정하여 변수 선언 
          integerOnly="true" : 정수로만 숫자 표현(소수점 버림)
         --%>
         
         <fmt:parseNumber var="c1" value="${(pInfo.currentPage - 1) / 10}" integerOnly="true"/>
         <fmt:parseNumber var="prev" value="${c1 * 10}" integerOnly="true"/>
         <c:set var="prevPage" value="${pageUrl}?cp=${prev}${searchStr}" />
         
         <fmt:parseNumber var="c2" value="${(pInfo.currentPage + 9) / 10 }" integerOnly="true" />
         <fmt:parseNumber var="next" value="${ c2 * 10 + 1}" integerOnly="true" />
         <c:set var="nextPage" value="${pageUrl}?cp=${next}${searchStr}" />
         
         
         
         <div class="my-5">
            <ul class="pagination">
               <%-- 현재 페이지가 10페이지 초과인 경우 --%>
               <c:if test="${pInfo.currentPage > 10}">
                  <li> <%-- 첫 페이지로 이동(<<) --%>
                     <a class="page-link" href="${firstPage}">&lt;&lt;</a>
                  </li>
                  <li> <%-- 이전 페이지로 이동(<) --%>
                     <a class="page-link" href="${prevPage}">&lt;</a>
                  </li>
               </c:if>
               
               <!--  페이지 목록   -->
               <c:forEach var="page" begin="${pInfo.startPage}" end="${pInfo.endPage}">
                  <c:choose>
                     <c:when test="${pInfo.currentPage == page}">
                        <li>
                           <a class="page-link">${page}</a>
                        </li>
                     </c:when>
                     
                     <c:otherwise>
                        <li>
                           <a class="page-link" href="${pageUrl}?cp=${page}${searchStr}">${page}</a>
                        </li>
                     </c:otherwise>
                  </c:choose>
               </c:forEach>
               

            <%-- 다음 페이지가 마지막 페이지 미만인 경우 --%>
            <c:if test="${ next < pInfo.maxPage}">
               <li>
                  <%-- 다음 페이지로 이동(>) --%> 
                  <a class="page-link" href="${nextPage}">&gt;</a>
               </li>
               <li>
                  <%-- 마지막 페이지로 이동(>>) --%> 
                  <a class="page-link" href="${lastPage}">&gt;&gt;</a>
               </li>
            </c:if>

         </ul>
         </div>
      
      
         <!-- 검색창 -->
         <div class="my-5">
            <form action="${contextPath }/search.do" method="GET" class="text-center" id="searchForm">
               <select name="sk" class="form-control" style="width: 100px; display: inline-block;">
                  <option value="title">글제목</option>
                  <option value="content">내용</option>
                  <option value="titcont">제목+내용</option>
                  <option value="writer">작성자</option>
               </select>
               <input type="text" name="sv" class="form-control" style="width: 25%; display: inline-block;">
               <button class="form-control btn btn-primary" style="width: 100px; display: inline-block;">검색</button>
            </form>


         </div>
   </div>
   <jsp:include page="../common/footer.jsp"></jsp:include>


   <script>
      // 게시글 상세보기 기능 (jquery를 통해 작업)
      
      $("#list-table td").on("click",function(){
         
         // 게시글 번호 얻어오기
         var boardNo = $(this).parent().children().eq(0).text();
         //console.log(boardNo);
         // 클릭이 되는지 테스트
         
         var url = "${contextPath}/board/view.do?cp=${pInfo.currentPage}&no=" + boardNo + "${searchStr}";
         
         location.href = url;
         
         
      });
      
      
      // 검색 내용이 있을 경우 검색창에 해당 내용을 작성해두는 기능
      (function(){
    	  var searchKey = "${param.sk}";
    	  // 파라미터 중 sk가 있을 경우 ex)"49"
    	  // 파라미터 중 sk가 없을 경우 ex) ""
    	  var searchValue = "${param.sv}";
    	  
    	  // 검색창 select의 option을 반복 접근
    	  $("select[name=sk] > option").each(function(index, item){
    		  // index : 현재 접근 중인 요소의 인덱스
    		  // item : 현재 접근 중인 요소
    		  
    		  		// title          title
    		  if( $(item).val() == searchKey ){ // 제목으로 검색한 경우
    			 $(item).prop("selected", true);
    		  }
    	  });
    	  
    	  // 검색어 입력창에 searchValue 값 출력
    	  $("input[name=sv]").val(searchValue);
    	  
      })();
   </script>
</body>
</html>
```
<br><br>

- BoardView.jsp

```jsp
<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt"%>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>게시글</title>
<style>
	#board-area{ height: 700px; }
	#board-content{ padding-bottom:150px;}

	.boardImgArea{
		height: 300px;
	}

	.boardImg{
		width : 100%;
		height: 100%;
		
		max-width : 300px;
		max-height: 300px;
		
		margin : auto;
	}
	
	/* 이미지 화살표 색 조정
	-> fill='%23000' 부분의 000을
	   RGB 16진수 값을 작성하여 변경 가능 
	 */
	.carousel-control-prev-icon {
 		background-image: url("data:image/svg+xml;charset=utf8,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23000' viewBox='0 0 8 8'%3E%3Cpath d='M5.25 0l-4 4 4 4 1.5-1.5-2.5-2.5 2.5-2.5-1.5-1.5z'/%3E%3C/svg%3E") !important;
	}
	
	.carousel-control-next-icon {
  		background-image: url("data:image/svg+xml;charset=utf8,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23000' viewBox='0 0 8 8'%3E%3Cpath d='M2.75 0l-1.5 1.5 2.5 2.5-2.5 2.5 1.5 1.5 4-4-4-4z'/%3E%3C/svg%3E") !important;
	}
	
	.replyWrite > table{
		width: 90%;
		align: center;
	}
	
	#replyContentArea{ width: 90%; }
	
	#replyContentArea > textarea{
	    resize: none;
    	width: 100%;
	}
	
	#replyBtnArea{
	    width: 100px;
	    text-align: center;
	}
	
	.rWriter{ margin-right: 30px;}
	.rDate{
		font-size: 0.7em;
		color : gray;
	}
	
	#replyListArea{
		list-style-type: none;
	}
	
	.board-dateArea{
		font-size: 14px;
	}
</style>
</head>
<body>
	<jsp:include page="../common/header.jsp"></jsp:include>
	<div class="container  my-5">

		<div>

			<div id="board-area">

				<!-- Category -->
				<h6 class="mt-4">카테고리 : [${board.categoryName}]</h6>
				
				<!-- Title -->
				<h3 class="mt-4">${board.boardTitle}</h3>

				<!-- Writer -->
				<p class="lead">
					작성자 : ${board.memberId}
				</p>

				<hr>

				<!-- Date -->
				<p>
					<span class="board-dateArea">
						작성일 : <fmt:formatDate value="${board.boardCreateDate}" pattern="yyyy년 MM월 dd일 HH:mm:ss" />
						<br>
						마지막 수정일 : <fmt:formatDate value="${board.boardModifyDate}" pattern="yyyy년 MM월 dd일 HH:mm:ss" />
					</span>
			 		<span class="float-right">조회수 ${board.readCount}</span>
				</p>

				<hr>
				<!-- 이미지 출력 -->


				<!-- Content -->
				<div id="board-content">${board.boardContent}</div>
				

				<hr>
				 
				
				<div>
				
					<%-- 로그인된 회원과 해당 글 작성자가 같은 경우--%>
					<c:if test="${!empty loginMember && (board.memberId) == loginMember.memberId }">
						<button id="deleteBtn" class="btn btn-primary float-right">삭제</button> 
						<a href="#" class="btn btn-primary float-right ml-1 mr-1">수정</a>
					</c:if>
					
					<%--
						상대경로 작성법
						 - ../ : 현재 위치에서 한단계 상위(주소 제일 마지막 /보다 왼쪽으로 한칸 앞 /)
						 
						 http://localhost:8080/wsp/board/view.do 에서
						 http://localhost:8080/wsp/search.do 으로
						 
						 검색 -> 게시글 상세조회 -> 목록 -> 상세조회 전 페이지
					 --%>
					
					<c:choose>
						<c:when test="${!empty param.sk && !empty param.sv}">
							<c:url var="goToList" value="../search.do">
								<c:param name="cp">${param.cp}</c:param>
								<c:param name="sk">${param.sk}</c:param>
								<c:param name="sv">${param.sv}</c:param>
							</c:url>
						</c:when>
						
						<c:otherwise>
							<c:url var="goToList" value="/board/list.do">
								<c:param name="cp">${param.cp}</c:param>
							</c:url>
						</c:otherwise>
					</c:choose>
					
					
					<a href="${goToList}" class="btn btn-primary float-right">목록으로</a>
				</div>
			</div>



		</div>
	</div>
	<jsp:include page="../common/footer.jsp"></jsp:include>
	
	
	<script>
		
	</script>
</body>
</html>
```

<br><br>

- boardInsert.jsp

```jsp
<%@ page language="java" contentType="text/html; charset=UTF-8"
	pageEncoding="UTF-8"%>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>게시판</title>
<style>
    .insert-label {
      display: inline-block;
      width: 80px;
      line-height: 40px
    }
    
    .boardImg{
    	cursor : pointer;
    }
</style>
</head>
<body>
		<jsp:include page="../common/header.jsp"></jsp:include>

		<div class="container my-5">

			<h3>게시글 등록</h3>
			<hr>
			<!-- 파일 업로드를 위한 라이브러리 cos.jar 라이브러리 다운로드(http://www.servlets.com/) -->
			
			<!-- 
				- enctype : form 태그 데이터가 서버로 제출 될 때 인코딩 되는 방법을 지정. (POST 방식일 때만 사용 가능)
				- application/x-www-form-urlencoded : 모든 문자를 서버로 전송하기 전에 인코딩 (form태그 기본값)
				- multipart/form-data : 모든 문자를 인코딩 하지 않음.(원본 데이터가 유지되어 이미지, 파일등을 서버로 전송 할 수 있음.) 
			-->
			<form action="${contextPath}/board/insert.do" method="post" 
				  enctype="multipart/form-data" role="form" onsubmit="return boardValidate();">

				<div class="mb-2">
					<label class="input-group-addon mr-3 insert-label">카테고리</label> 
					<select	class="custom-select" id="categoryCode" name="categoryCode" style="width: 150px;">
						<option value="10">운동</option>
						<option value="20">영화</option>
						<option value="30">음악</option>
						<option value="40">요리</option>
						<option value="50">게임</option>
						<option value="60">기타</option>
					</select>
				</div>
				<div class="form-inline mb-2">
					<label class="input-group-addon mr-3 insert-label">제목</label> 
					<input type="text" class="form-control" id="boardTitle" name="boardTitle" size="70">
				</div>

				<div class="form-inline mb-2">
					<label class="input-group-addon mr-3 insert-label">작성자</label>
					<h5 class="my-0" id="writer">${loginMember.memberId }</h5>
				</div>


				<div class="form-inline mb-2">
					<label class="input-group-addon mr-3 insert-label">작성일</label>
					<h5 class="my-0" id="today"></h5>
				</div>

				<hr>

				<div class="form-inline mb-2">
					<label class="input-group-addon mr-3 insert-label">썸네일</label>
					<div class="boardImg" id="titleImgArea">
						<img id="titleImg" width="200" height="200">
					</div>
				</div>

				<div class="form-inline mb-2">
					<label class="input-group-addon mr-3 insert-label">업로드<br>이미지</label>
					<div class="mr-2 boardImg" id="contentImgArea1">
						<img id="contentImg1" width="150" height="150">
					</div>

					<div class="mr-2 boardImg" id="contentImgArea2">
						<img id="contentImg2" width="150" height="150">
					</div>

					<div class="mr-2 boardImg" id="contentImgArea3">
						<img id="contentImg3" width="150" height="150">
					</div>
				</div>


				<!-- 파일 업로드 하는 부분 -->
				<div id="fileArea">
					<!--  multiple 속성
						- input 요소 하나에 둘 이상의 값을 입력할 수 있음을 명시 (파일 여러개 선택 가능)
					 -->
					<input type="file" id="img0" name="img0" onchange="LoadImg(this,0)"> 
					<input type="file" id="img1" name="img1" onchange="LoadImg(this,1)"> 
					<input type="file" id="img2" name="img2" onchange="LoadImg(this,2)"> 
					<input type="file" id="img3" name="img3" onchange="LoadImg(this,3)"> 
				</div>

				<div class="form-group">
					<div>
						<label for="content">내용</label>
					</div>
					<textarea class="form-control" id="boardContent" name="boardContent" rows="15" style="resize: none;"></textarea>
				</div>


				<hr class="mb-4">

				<div class="text-center">
					<button type="submit" class="btn btn-primary">등록</button>
					<button type="button" class="btn btn-primary">목록으로</button>
				</div>

			</form>
		</div>

		<jsp:include page="../common/footer.jsp"></jsp:include>
		
		
	<script>
		(function printToday(){
			// 오늘 날짜 출력 
	 		var today = new Date();
			var month = (today.getMonth()+1);
			var date = today.getDate();
	
	  	var str = today.getFullYear() + "-"
	        		+ (month < 10 ? "0"+month : month) + "-"
	        		+ (date < 10 ? "0"+date : date);
			$("#today").html(str);
		})();

		// 유효성 검사 
		function boardValidate() {
			if ($("#boardTitle").val().trim().length == 0) {
				alert("제목을 입력해 주세요.");
				$("#title").focus();
				return false;
			}

			if ($("#content").val().trim().length == 0) {
				alert("내용을 입력해 주세요.");
				$("#content").focus();
				return false;
			}
		}
		
		// 이미지 영역을 클릭할 때 파일 첨부 창이 뜨도록 설정하는 함수
		$(function(){
			$("#fileArea").hide(); // #fileArea 요소를 숨김.
			
			$(".boardImg").on("click", function(){ // 이미지 영역이 클릭되었을 때
				
				// 클릭한 이미지 영역 인덱스 얻어오기
				var index = $(".boardImg").index(this);
							// -> 클릭된 요소가 .boardImg 중 몇번째 인덱스인지 반환
							
				//console.log(index);
							
				// 클릭된 영역 인덱스에 맞는 input file 태그 클릭
				$("#img" + index).click();
				
			});
			
		});
		
		 
	   // 각각의 영역에 파일을 첨부 했을 경우 미리 보기가 가능하도록 하는 함수
	   function LoadImg(value, num) {
		   // value.files : 파일이 선택되어 있으면 true
		   // value.files[0] : 여러 파일 중 첫 번째 파일이 업로드 되어 있으면 true
		   
		   if(value.files && value.files[0]){ // 해당 요소에 업로드된 파일이 있을 경우
			   
			   var reader = new FileReader();
				// 자바스크립트 FileReader
	        	// 웹 애플리케이션이 비동기적으로 데이터를 읽기 위하여 
	        	// 읽을 파일을 가리키는 File 혹은 Blob객체를 이용해 
	        	// 파일의 내용을 읽고 사용자의 컴퓨터에 저장하는 것을 가능하게 해주는 객체
	        	
	        	reader.readAsDataURL(value.files[0]);
	        	// FileReader.readAsDataURL()
		      	// 지정된의 내용을 읽기 시작합니다. 
		      	// Blob완료되면 result속성 data:에 파일 데이터를 나타내는 URL이 포함 됩니다.
		      	
		      	reader.onload = function(e){
		      	// FileReader.onload
				// load 이벤트의 핸들러. 이 이벤트는 읽기 동작이 성공적으로 완료 되었을 때마다 발생합니다.
				
				
				// 읽어들인 내용(이미지 파일)을 화면에 출력
				
				// num == 0, 1, 2, 3 중 하나 == onchange="LoadImg(this,0)"
				$(".boardImg").eq(num).children("img").attr("src", e.target.result);
		      	// e.target.result : 파일 읽기 동작을 성공한 요소가 읽어들인 파일 내용

		      	}
		   }
		   
		}
	   
	</script>
</body>
</html>
```